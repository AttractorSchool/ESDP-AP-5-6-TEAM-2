<!-- Modal -->
{% load static %}
<div class="modal fade payment_modal" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #e1dbdb">
                <h5 class="modal-title" id="exampleModalLabel">Оплатить заказ</h5>
                <button type="button" class="btn-close close_modal" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="card text-dark bg-light mb-3">
                    <div class="card-body">
                        <h5 class="card-title" style="color: #0b5ed7">Выбранный заказ-наряд для оплаты</h5>
                        <div class="row row-cols-2">
                            <div class="col idorderclass">
                            </div>
                            <div class="col dayorder">
                            </div>
                            <div class="col statusorder">
                            </div>
                            <div class="col paymentstatusorder">
                            </div>
                            <div class="col contractororder">
                            </div>
                            <div class="col ownorder">
                            </div>
                            <div class="col showForm"></div>
                        </div>
                    </div>

                </div>

                <div id="showForm">
                    <form method="POST" action=""
                          id="paymentForm" name="payment">
                        {% csrf_token %}
                        <div class="mb-3">
                            <select id="payment_status_id" name="payment_status"
                                    class="form-select border-secondary bg-transparent"
                                    style="background-image: none !important;">
                                <option selected value="Оплачено">Оплачено</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <select name="method" class="form-select border-secondary bg-transparent method"
                                    id="id_method" required>
                                <option value="">Выберите метод оплаты</option>
                                {% for method in payment_methods %}

                                    <option value="{{ method.id }}">{{ method.name }}</option>

                                {% endfor %}
                            </select>

                        </div>
                        <div class="row">
                            <h4>Способ оплаты</h4>
                            <hr>
                            <div class="col-md-12 pay_method" id="pay_method">

                            </div>
                            <div class="error_text"></div>

                            <div class="form-text text-danger">
                            </div>
                            <div class="sendId">

                            </div>
                            <br>
                        </div>
                        <div class="submit_button_form">
                            <input type="submit" value="Оплатить" id="submitIfOk" class="btn btn-primary submitValues" onclick="stringLengthCheckSecond(document.payment.consignment, document.payment.invoice, 0, 100)">
                        </div>

                        <script>
                            var tpID =
                            {{ tpID }}
                        </script>
                    </form>
                </div>
            </div>

            <div class="modal-footer">

            </div>

            <div class="row">
                <div class="col-md-12 pay_method" id="pay_method">

                </div>
                <div class="error_text"></div>

                <div class="form-text text-danger">
                </div>
                <div class="sendId">

                </div>
                <br>
            </div>
            <div class="submit_button_form">

            </div>

            <script>
                var tpID =
                {{ tpID }}
            </script>
            <script>
                // При выборе метода оплаты выводятся поля соответствующих данных для заполнения
                const selectElement = document.querySelector('.method');

                selectElement.addEventListener('change', (event) => {
                    if (parseInt(event.target.value) == 1) {
                        const cash = document.querySelector('.pay_method')
                        cash.innerHTML = ''
                        cash.innerHTML = `
                                    <textarea cols=5 rows=3 type="text" class="form-control border-secondary details_cash" id="details_cash" name='details_cash' hidden></textarea>
                                    <input type="text" class="form-control border-secondary" id="details_cashless" name='details_cashless' value="" hidden>
                                    <input type="text" class="form-control border-secondary" id="details_kaspi" name='details_kaspi' value="" hidden>
                                    <input type="text" class="form-control border-secondary" id="consignment" name='consignment' value="" hidden>
                                    <input type="text" class="form-control border-secondary" id="invoice" name='invoice' value="" hidden>`


                    } else if (parseInt(event.target.value) == 2) {
                        const cash = document.querySelector('.pay_method')
                        const btn = document.querySelector('.submit_button_form')

                        cash.innerHTML = ''
                        cash.innerHTML = `
                                    <input type="text" class="form-control border-secondary" id="details_cash" name='details_cash' value="" hidden>
                                    <input type="text" class="form-control border-secondary" id="details_cashless" name='details_cashless' value="" hidden>

                                    <input type="text" class="form-control border-secondary" id="details_kaspi" name='details_kaspi' value="" hidden>
                                    <label for="consignment" class="form-label">Накладное</label><br>
                                    <textarea cols=5 rows=3  type="text" class="form-control border-secondary" id="consignment" name='consignment'></textarea>
                                    <label for="invoice" class="form-label">Счет фактура</label><br>
                                    <textarea cols=5 rows=3  type="text" class="form-control border-secondary" id="invoice" name='invoice' ></textarea>`

                    } else if (parseInt(event.target.value) == 3) {
                        const cash = document.querySelector('.pay_method')
                        cash.innerHTML = ''
                        cash.innerHTML = `
                                    <input type="text" class="form-control border-secondary" id="details_cash" name='details_cash' value="" hidden>
                                    <input type="text" class="form-control border-secondary" id="details_cashless" name='details_cashless' value="" hidden>

                                    <div class="form-check">
                                    <input class="form-check-input" type="radio" name="details_kaspi" id="details_kaspiQR" value="Kaspi QR">
                                    <label class="form-check-label" for="details_kaspiQR">
                                    Kaspi QR
                                    </label>
                                    </div>
                                    <div class="form-check">
                                    <input class="form-check-input" type="radio" name="details_kaspi" id="details_kaspiTransfer" value="Kaspi Перевод">
                                    <label class="form-check-label" for="details_kaspiTransfer">
                                    Kaspi Перевод
                                    </label>
                                    </div>
                                    <div class="form-check">
                                    <input class="form-check-input" type="radio" name="details_kaspi" id="details_kaspiRed" value="Kaspi RED">
                                    <label class="form-check-label" for="details_kaspiRed">
                                    Kaspi RED
                                    </label>
                                    </div>

                                    <input type="text" class="form-control border-secondary" id="consignment" name='consignment' value="" hidden>
                                    <input type="text" class="form-control border-secondary" id="invoice" name='invoice' value="" hidden>`

                    } else if (event.target.value == '') {
                        const cash = document.querySelector('.pay_method')
                        const btn = document.querySelector('.submit_button_form')
                        btn.innerHTML = ''
                        cash.innerHTML = ''
                        cash.innerHTML = `
                                    <input type="text" class="form-control border-secondary" id="details_cash" name='details_cash' value="" hidden>
                                    <input type="text" class="form-control border-secondary" id="details_cashless" name='details_cashless' value="" hidden>

                                    <textarea cols=5 rows=3 type="text" class="form-control border-secondary" id="details_kaspi" name='details_kaspi' hidden></textarea>
                                    <input type="text" class="form-control border-secondary" id="consignment" name='consignment' value="" hidden>
                                    <input type="text" class="form-control border-secondary" id="invoice" name='invoice' value="" hidden>`
                    }
                });


                // Функция для валидации данных при безналичным способом
                function stringLengthCheckSecond(name1, name2, minlength, maxlength) {
                    var mnlen = minlength;
                    var mxlen = maxlength;

                    if (name1.value.length < mnlen || name1.value.length > mxlen || name2.value.length < mnlen || name2.value.length > mxlen) {
                        let error_text = document.querySelector('.error_text')
                        error_text.innerHTML = `<div class="alert alert-danger d-flex align-items-center pt-1 pb-1 pe-4 ps-4 m-0"
                                     role="alert">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor"
                                         class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2" viewBox="0 0 16 16"
                                         role="img"
                                         aria-label="Warning:">
                                        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                                    </svg>
                                    <div>
                                        <p>Проверьте описание Накладное: ${name1.value}</p>

                                        <p>Проверьте описание Счет Фактура: ${name2.value}</p>
                                        <p>Описание не должно превышать ${mxlen} символов</p>


                                    </div>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"
                                            aria-label="Close"></button>
                                </div>`
                        name1.value = ''
                        name2.value = ''
                        return false;

                    } else {
                        name1.value
                        name2.value
                        let error_text = document.querySelector('.error_text')
                        error_text.innerHTML = ''
                        {#error_text.innerHTML = `<div class="alert alert-success" role="alert">#}
                        {#                                        Описание ${name1.value}, ${name2.value} принято, нажмите отправить повторно#}
                        {#                                    </div>`#}
                        let submit = document.querySelector('#submitIfOk')

                        submit.addEventListener('click', (event) => {
                            submit.dataset.dismiss = 'modal'
                            window.location.replace(`${locationHost}/org/1/tp/${tpID}/`)
                        })

                    }
                }

                // Закрытие модального окна кнопкой X и обновление страницы с актуальными данными после изменения

                let submit = document.querySelector('.close_modal')

                submit.addEventListener('click', (event) => {
                    submit.dataset.dismiss = 'modal'
                    window.location.replace(`${locationHost}/org/1/tp/${tpID}/`)
                })

            </script>
            {#            {% block js_block %}#}
            {#                <script src="{% static 'js/payment/pay_order.js' %}"></script>#}
            {#            {% endblock %}#}
            <script>
            </script>
        </div>
    </div>
</div>
